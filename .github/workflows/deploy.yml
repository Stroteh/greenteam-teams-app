name: Deploy GreenTeam to GitHub Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    # 1. Checkout kod
    - name: Checkout repository
      uses: actions/checkout@v4
    
    # 2. Preveri datoteke
    - name: Check required files
      run: |
        echo "ğŸ“ Preverjam datoteke..."
        [ -f "index.html" ] || { echo "âŒ index.html not found"; exit 1; }
        [ -f "firebase-config.js" ] || { echo "âŒ firebase-config.js not found"; exit 1; }
        echo "âœ… Vse datoteke obstajajo"
    
    # 3. POPRAVLJENO: Zamenjaj placeholdere v obstojeÄi firebase-config.js
    - name: Replace Firebase placeholders with secrets
      run: |
        echo "ğŸ”„ Zamenjujem Firebase placeholderje..."
        
        # Preveri vsebino datoteke
        echo "ğŸ“„ Trenutna vsebina firebase-config.js (prvih 15 vrstic):"
        head -15 firebase-config.js
        
        # Zamenjaj VSE placeholdere z realnimi vrednostmi
        sed -i "s|FIREBASE_API_KEY|${{ secrets.FIREBASE_API_KEY }}|g" firebase-config.js
        sed -i "s|FIREBASE_AUTH_DOMAIN|${{ secrets.FIREBASE_AUTH_DOMAIN }}|g" firebase-config.js
        sed -i "s|FIREBASE_PROJECT_ID|${{ secrets.FIREBASE_PROJECT_ID }}|g" firebase-config.js
        sed -i "s|FIREBASE_MESSAGING_SENDER_ID|${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}|g" firebase-config.js
        sed -i "s|FIREBASE_APP_ID|${{ secrets.FIREBASE_APP_ID }}|g" firebase-config.js
        sed -i "s|FIREBASE_STORAGE_BUCKET|${{ secrets.FIREBASE_STORAGE_BUCKET }}|g" firebase-config.js
       
        
        echo "âœ… Placeholderji zamenjani"
        echo "ğŸ“„ Nova vsebina firebase-config.js (prvih 15 vrstic):"
        head -15 firebase-config.js
    
    # 4. Setup GitHub Pages
    - name: Setup Pages
      uses: actions/configure-pages@v3
    
    # 5. Upload artifact
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: '.'
    
    # 6. Deploy to GitHub Pages
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
      with:
        timeout: 600000
    
    # 7. Success message
    - name: Success
      run: |
        echo "ğŸ‰ Deployment successful!"
        echo "ğŸŒ Your app is available at: ${{ steps.deployment.outputs.page_url }}"
        echo ""
        echo "ğŸ” Preveri Firebase konfiguracijo:"
        echo "   - Odpri aplikacijo"
        echo "   - Pritisni F12 za Developer Tools"
        echo "   - Pojdi na Console"
        echo "   - ÄŒe vidiÅ¡ 'âœ… Firebase uspeÅ¡no povezan', je vse OK"
